version: '3.8'

services:
  rag-ai-app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: rag-ai-clone-dev
    environment:
      - OLLAMA_API_URL=${OLLAMA_API_URL:-http://host.docker.internal:11434}
      - OLLAMA_MODEL=${OLLAMA_MODEL:-mistral:7b}
      - TELEGRAM_API_ID=${TELEGRAM_API_ID}
      - TELEGRAM_API_HASH=${TELEGRAM_API_HASH}
      - TELEGRAM_PHONE=${TELEGRAM_PHONE}
      - BOT_TOKEN=${BOT_TOKEN}
      - PYTHONUNBUFFERED=1
      - DEBUG=true
      - LOG_LEVEL=DEBUG
    volumes:
      - ./backend:/app/backend:rw
      - ./logs:/app/logs:rw
      - ./.env:/app/.env:ro
    ports:
      - "8080:8080"  # –î–ª—è –¥–µ–±–∞–≥–∞/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    working_dir: /app/backend
    command: >
      sh -c "
        echo 'ü§ñ RAG AI Telegram Clone (Dev Mode)' &&
        echo '====================================' &&
        echo '' &&
        echo '–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:' &&
        echo '  make collect    - –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö' &&
        echo '  make build-db   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ë–î' &&
        echo '  make analyze    - –ê–Ω–∞–ª–∏–∑ —Å—Ç–∏–ª—è' &&
        echo '  make run-bot    - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞' &&
        echo '  make all        - –í–µ—Å—å –ø–∞–π–ø–ª–∞–π–Ω' &&
        echo '' &&
        tail -f /dev/null  # –û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥
      "
    stdin_open: true
    tty: true
    restart: unless-stopped